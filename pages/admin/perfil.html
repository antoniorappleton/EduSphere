<!doctype html>
<html lang="pt">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>EduSphere Admin — Perfil</title>

    <link rel="stylesheet" href="../../styles.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
    />

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
    <script src="../../public/js/supabaseClient.js"></script>
    <script src="../../public/js/auth.js"></script>
  </head>

  <body class="home">
    <script>
      document.addEventListener("auth-ready", () => {
        Auth.requireRole("admin", "../../index.html");
      });
      if (window.Auth && window.Auth.isReady) {
        Auth.requireRole("admin", "../../index.html");
      }
    </script>

    <div class="admin-layout">
      <!-- SIDEBAR -->
      <aside class="admin-sidebar" id="sidebarAdmin">
        <a class="admin-sidebar__logo" href="../../index.html">
          <img src="/public/img/logo-icon.svg" alt="EduSphere" />
          <span>EduSphere</span>
        </a>

        <nav class="admin-nav">
          <a href="../../public/admin.html" class="admin-nav-link">
            <span class="material-symbols-outlined">grid_view</span>
            <span>Dashboard</span>
          </a>
          <a href="../../public/admin.html" class="admin-nav-link">
            <span class="material-symbols-outlined">group</span>
            <span>Explicadores</span>
          </a>
          <a href="#" class="admin-nav-link active">
            <span class="material-symbols-outlined">person</span>
            <span>Perfil</span>
          </a>
          <a
            href="#"
            class="admin-nav-link"
            id="btnLogoutSidebar"
            style="color: #ef4444"
          >
            <span class="material-symbols-outlined">logout</span>
            <span>Sair</span>
          </a>
        </nav>
      </aside>

      <!-- MAIN -->
      <main class="admin-main">
        <header class="admin-header">
          <div class="admin-header__info">
            <h1>O Meu Perfil</h1>
            <p>Gere as tuas credenciais de acesso administrador.</p>
          </div>
        </header>

        <div class="admin-grid-2">
          <section class="admin-card">
            <h2 class="admin-card__title">
              <span class="material-symbols-outlined">lock</span>
              Alterar Password
            </h2>
            <form id="fChangePass" class="auth__form">
              <div class="password-wrapper">
                <input
                  name="password"
                  type="password"
                  placeholder="Nova Password"
                  minlength="6"
                  required
                />
                <button type="button" class="password-toggle" tabindex="-1">
                  <span class="material-symbols-outlined">visibility</span>
                </button>
              </div>
              <div class="password-wrapper">
                <input
                  name="confirmPassword"
                  type="password"
                  placeholder="Confirmar Nova Password"
                  minlength="6"
                  required
                />
                <button type="button" class="password-toggle" tabindex="-1">
                  <span class="material-symbols-outlined">visibility</span>
                </button>
              </div>
              <button
                class="button"
                type="submit"
                style="width: 100%; margin-top: 10px"
              >
                Atualizar Password
              </button>
              <div id="msgPass" class="auth__msg"></div>
            </form>
          </section>

          <section class="admin-card">
            <h2 class="admin-card__title">
              <span class="material-symbols-outlined">info</span>
              Informação da Conta
            </h2>
            <div id="adminInfo">
              <p style="margin-bottom: 8px">
                <strong>Email:</strong> <span id="adminEmail">...</span>
              </p>
              <p style="margin-bottom: 24px">
                <strong>Nível de Acesso:</strong>
                <span class="badge badge--success">Administrador Total</span>
              </p>

              <hr
                style="
                  margin-bottom: 24px;
                  border: 0;
                  border-top: 1px solid var(--admin-border);
                "
              />

              <button
                id="btnProfileLogout"
                class="button"
                style="background-color: #ef4444; width: 100%"
              >
                Sair da Conta
              </button>
            </div>
          </section>
        </div>
      </main>
    </div>

    <footer style="margin-top: auto; padding: 24px; font-size: 0.8125rem">
      © <span id="y"></span> EduSphere
    </footer>

    <script src="../../public/js/pages/perfil-admin.js"></script>
    <script>
      document.getElementById("y").textContent = new Date().getFullYear();
      document
        .getElementById("btnLogoutSidebar")
        .addEventListener("click", () => Auth.signOut("../../index.html"));
      document
        .getElementById("btnProfileLogout")
        ?.addEventListener("click", () => Auth.signOut("../../index.html"));

      // Password Toggle (reutilizado)
      document.querySelectorAll(".password-toggle").forEach((btn) => {
        btn.addEventListener("click", () => {
          const input = btn.previousElementSibling;
          const isPass = input.type === "password";
          input.type = isPass ? "text" : "password";
          btn.querySelector("span").textContent = isPass
            ? "visibility_off"
            : "visibility";
        });
      });

      // Carregar Info
      async function loadInfo() {
        const u = await Auth.getSessionUser();
        if (u) document.getElementById("adminEmail").textContent = u.email;
      }
      loadInfo();
    </script>
  </body>
</html>
