<!doctype html>
<html lang="pt">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="../../styles.css" />
  <link rel="stylesheet" href="../../css/explicador.css" />

  <title>EduSphere — Faturação</title>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
  <script src="../../public/js/supabaseClient.js"></script>
</head>

<body class="home">

  <section id="explPanel" class="expl-shell">

    <!-- NAVIGATION -->
    <nav id="explSidebarNav" class="expl-sidebar-nav">
      <button class="expl-nav-btn" onclick="location.href='dashboard.html'">
        <span class="expl-nav-icon"><svg class="expl-nav-svg" viewBox="0 0 24 24">
            <rect x="4" y="4" width="7" height="7" rx="1.5" />
            <rect x="13" y="4" width="7" height="7" rx="1.5" />
            <rect x="4" y="13" width="7" height="7" rx="1.5" />
            <rect x="13" y="13" width="7" height="7" rx="1.5" />
          </svg></span>
        <span class="expl-nav-label">Dashboard</span>
      </button>

      <button class="expl-nav-btn" onclick="location.href='alunos.html'">
        <span class="expl-nav-icon"><svg class="expl-nav-svg" viewBox="0 0 24 24">
            <circle cx="12" cy="9" r="3.2" />
            <path d="M6.5 19.5c1.2-2.3 3-3.6 5.5-3.6s4.3 1.3 5.5 3.6" />
          </svg></span>
        <span class="expl-nav-label">Alunos</span>
      </button>

      <button class="expl-nav-btn" onclick="location.href='calendario.html'">
        <span class="expl-nav-icon"><svg class="expl-nav-svg" viewBox="0 0 24 24">
            <rect x="4" y="5.5" width="16" height="14" rx="2" />
            <path d="M4 10h16" />
            <path d="M9 4v3" />
            <path d="M15 4v3" />
          </svg></span>
        <span class="expl-nav-label">Calendário</span>
      </button>

      <button class="expl-nav-btn expl-nav-btn--active" onclick="location.href='faturacao.html'">
        <span class="expl-nav-icon"><svg class="expl-nav-svg" viewBox="0 0 24 24">
            <path d="M15.5 7.5c-1-.7-2.1-1.1-3.4-1.1-2.6 0-4.6 1.8-4.6 4.6s2 4.6 4.6 4.6c1.3 0 2.4-.4 3.4-1.1" />
            <path d="M11 5v14" />
          </svg></span>
        <span class="expl-nav-label">Faturação</span>
      </button>

      <button class="expl-nav-btn" onclick="location.href='relatorios.html'">
        <span class="expl-nav-icon"><svg class="expl-nav-svg" viewBox="0 0 24 24">
            <path d="M4 18.5h16" />
            <path d="M6.5 15l3.2-4 3.2 2.7 4.1-5.2" />
            <path d="M16.8 8.5h3v3" />
          </svg></span>
        <span class="expl-nav-label">Relatórios</span>
      </button>

      <div style="margin-top:auto">
        <button class="expl-nav-btn" id="btnLogoutNav" style="color:#ef4444">
          <span class="expl-nav-label">Sair</span>
        </button>
      </div>
    </nav>

    <!-- CONTENT -->
    <div class="expl-main">
      <header class="expl-header-bar">
        <div class="expl-header-info">
          <h1 class="expl-page-title">Faturação</h1>
          <p class="expl-hello-sub">Consulta mensalidades pagas e em falta.</p>
        </div>
      </header>

      <div class="expl-body">

        <div class="expl-filter-row">
          <div class="expl-filter-controls" style="margin-left:0;">
            <label class="expl-filter-field">
              <span>Mês</span>
              <select id="fat-filtro-mes">
                <option value="1">Janeiro</option>
                <option value="2">Fevereiro</option>
                <option value="3">Março</option>
                <option value="4">Abril</option>
                <option value="5">Maio</option>
                <option value="6">Junho</option>
                <option value="7">Julho</option>
                <option value="8">Agosto</option>
                <option value="9">Setembro</option>
                <option value="10">Outubro</option>
                <option value="11">Novembro</option>
                <option value="12">Dezembro</option>
              </select>
            </label>

            <label class="expl-filter-field">
              <span>Ano</span>
              <select id="fat-filtro-ano">
                <option value="2026">2026</option>
                <option value="2025">2025</option>
              </select>
            </label>
          </div>
        </div>

        <div class="expl-grid-2" style="margin-top:1.5rem;">
          <!-- Mensalidades em falta -->
          <article class="expl-card">
            <h3 class="expl-subsection-title">Mensalidades em falta (mês atual)</h3>
            <div class="table-wrapper perfil-table-wrapper">
              <table class="table table--wide tabela perfil-tabela" id="tblMensalidadesPendentes">
                <thead>
                  <tr>
                    <th>Aluno</th>
                    <th>Mês</th>
                    <th>Previsto (€)</th>
                    <th>Pago (€)</th>
                    <th>Em falta (€)</th>
                    <th>Estado</th>
                    <th>Avisado</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td colspan="7">Ainda não existem mensalidades em falta.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </article>

          <!-- Mensalidades pagas -->
          <article class="expl-card">
            <h3 class="expl-subsection-title">Mensalidades pagas (mês atual)</h3>
            <div class="table-wrapper perfil-table-wrapper">
              <table class="table table--wide tabela perfil-tabela" id="tblMensalidadesPagas">
                <thead>
                  <tr>
                    <th>Aluno</th>
                    <th>Mês</th>
                    <th>Pago (€)</th>
                    <th>Previsto (€)</th>
                    <th>Estado</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td colspan="5">Ainda não existem mensalidades pagas.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </article>
        </div>

      </div>
    </div>
    <!-- BOTTOM NAVIGATION (MOBILE) -->
    <nav class="app-footer-nav">
      <a href="dashboard.html" class="app-nav-item">
        <span class="material-symbols-outlined">grid_view</span>
        <span>Dashboard</span>
      </a>
      <a href="alunos.html" class="app-nav-item">
        <span class="material-symbols-outlined">group</span>
        <span>Alunos</span>
      </a>
      <a href="calendario.html" class="app-nav-item">
        <span class="material-symbols-outlined">calendar_month</span>
        <span>Calendário</span>
      </a>
      <a href="faturacao.html" class="app-nav-item">
        <span class="material-symbols-outlined">payments</span>
        <span>Faturação</span>
      </a>
      <a href="relatorios.html" class="app-nav-item">
        <span class="material-symbols-outlined">trending_up</span>
        <span>Relatórios</span>
      </a>
    </nav>
  </section>

  <!-- Navigation Logic -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
  <script src="../../public/js/nav.js"></script>

  <script>
    document.getElementById('btnLogoutNav')?.addEventListener('click', async () => {
      await supabase.auth.signOut();
      location.href = '../../login.html';
    });

    // Auth Check
    (async function () {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) location.href = '../../index.html';
    })();
  </script>
</body>

</html>