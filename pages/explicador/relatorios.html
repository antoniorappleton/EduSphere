<!doctype html>
<html lang="pt">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="../../styles.css" />
    <link rel="stylesheet" href="../../css/explicador.css" />

    <link rel="stylesheet" href="../../css/nav.css" />
    <title>EduSphere — Relatórios</title>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../../public/js/supabaseClient.js"></script>
  </head>

  <body class="home has-footer-nav">
    <section id="explPanel" class="expl-shell">
      <!-- NAVIGATION -->
      <nav id="explSidebarNav" class="expl-sidebar-nav">
        <button class="expl-nav-btn" onclick="location.href = 'dashboard.html'">
          <span class="expl-nav-icon"
            ><svg class="expl-nav-svg" viewBox="0 0 24 24">
              <rect x="4" y="4" width="7" height="7" rx="1.5" />
              <rect x="13" y="4" width="7" height="7" rx="1.5" />
              <rect x="4" y="13" width="7" height="7" rx="1.5" />
              <rect x="13" y="13" width="7" height="7" rx="1.5" /></svg
          ></span>
          <span class="expl-nav-label">Dashboard</span>
        </button>

        <button class="expl-nav-btn" onclick="location.href = 'alunos.html'">
          <span class="expl-nav-icon"
            ><svg class="expl-nav-svg" viewBox="0 0 24 24">
              <circle cx="12" cy="9" r="3.2" />
              <path d="M6.5 19.5c1.2-2.3 3-3.6 5.5-3.6s4.3 1.3 5.5 3.6" /></svg
          ></span>
          <span class="expl-nav-label">Alunos</span>
        </button>

        <button
          class="expl-nav-btn"
          onclick="location.href = 'calendario.html'"
        >
          <span class="expl-nav-icon"
            ><svg class="expl-nav-svg" viewBox="0 0 24 24">
              <rect x="4" y="5.5" width="16" height="14" rx="2" />
              <path d="M4 10h16" />
              <path d="M9 4v3" />
              <path d="M15 4v3" /></svg
          ></span>
          <span class="expl-nav-label">Calendário</span>
        </button>

        <button class="expl-nav-btn" onclick="location.href = 'faturacao.html'">
          <span class="expl-nav-icon"
            ><svg class="expl-nav-svg" viewBox="0 0 24 24">
              <path
                d="M15.5 7.5c-1-.7-2.1-1.1-3.4-1.1-2.6 0-4.6 1.8-4.6 4.6s2 4.6 4.6 4.6c1.3 0 2.4-.4 3.4-1.1"
              />
              <path d="M11 5v14" /></svg
          ></span>
          <span class="expl-nav-label">Faturação</span>
        </button>

        <button
          class="expl-nav-btn expl-nav-btn--active"
          onclick="location.href = 'relatorios.html'"
        >
          <span class="expl-nav-icon"
            ><svg class="expl-nav-svg" viewBox="0 0 24 24">
              <path d="M4 18.5h16" />
              <path d="M6.5 15l3.2-4 3.2 2.7 4.1-5.2" />
              <path d="M16.8 8.5h3v3" /></svg
          ></span>
          <span class="expl-nav-label">Relatórios</span>
        </button>

        <button class="expl-nav-btn" onclick="location.href = 'perfil.html'">
          <span class="expl-nav-icon">
            <svg
              class="expl-nav-svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
          </span>
          <span class="expl-nav-label">Perfil</span>
        </button>

        <div style="margin-top: auto">
          <button class="expl-nav-btn" id="btnLogoutNav" style="color: #ef4444">
            <span class="expl-nav-label">Sair</span>
          </button>
        </div>
      </nav>

      <!-- CONTENT -->
      <div class="expl-main">
        <header class="expl-header-bar">
          <div class="expl-header-info">
            <h1 class="expl-page-title">Relatórios</h1>
            <p class="expl-hello-sub">Análise detalhada da tua atividade.</p>
          </div>
        </header>

        <div class="expl-body">
          <!-- KPI CARDS -->
          <div class="rel-kpi-grid">
            <div class="rel-kpi-card">
              <p class="rel-kpi-label">Alunos Ativos</p>
              <p class="rel-kpi-value" id="kpi-alunos">0</p>
              <p class="rel-kpi-sub">este mês</p>
            </div>
            <div class="rel-kpi-card">
              <p class="rel-kpi-label">Faturação do Mês</p>
              <p
                class="rel-kpi-value"
                id="kpi-faturacao"
                style="color: #16a34a"
              >
                €0,00
              </p>
              <p class="rel-kpi-sub">recebido</p>
            </div>
            <div class="rel-kpi-card">
              <p class="rel-kpi-label">Sessões do Mês</p>
              <p class="rel-kpi-value" id="kpi-sessoes">0</p>
              <p class="rel-kpi-sub">realizadas</p>
            </div>
            <div class="rel-kpi-card">
              <p class="rel-kpi-label">Taxa de Cobrança</p>
              <p class="rel-kpi-value" id="kpi-taxa" style="color: #2563eb">
                0%
              </p>
              <p class="rel-kpi-sub">pago / previsto</p>
            </div>
          </div>

          <!-- CHARTS -->
          <div class="relatorios-grid" style="grid-template-columns: 1fr 1fr">
            <div class="rel-card">
              <h3>Faturação Mensal</h3>
              <p style="color: #666; font-size: 0.9rem">Previsto vs Recebido</p>
              <div class="rel-chart-box">
                <canvas id="chartFatMensal"></canvas>
              </div>
            </div>

            <div class="rel-card">
              <h3>Sessões Mensais</h3>
              <p style="color: #666; font-size: 0.9rem">
                Total de sessões por mês
              </p>
              <div class="rel-chart-box">
                <canvas id="chartSessoes"></canvas>
              </div>
            </div>
          </div>

          <div
            class="relatorios-grid"
            style="margin-top: 1.5rem; grid-template-columns: 1fr 1fr"
          >
            <div class="rel-card">
              <h3>Alunos Ativos</h3>
              <p style="color: #666; font-size: 0.9rem">Evolução mensal</p>
              <div class="rel-chart-box">
                <canvas id="chartAlunos"></canvas>
              </div>
            </div>

            <div class="rel-card">
              <h3>Distribuição Disciplinas</h3>
              <p style="color: #666; font-size: 0.9rem">
                Proporção de alunos por área
              </p>
              <div class="rel-chart-box">
                <canvas id="chartDisciplinas"></canvas>
              </div>
            </div>
          </div>

          <!-- MONTHLY REPORTS LIST -->
          <div class="rel-card" style="margin-top: 2rem">
            <h3>Relatórios Mensais</h3>
            <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem">
              Clique num mês para ver o detalhe
            </p>
            <div id="monthly-reports-list">
              <p style="color: #94a3b8">A carregar...</p>
            </div>
          </div>
        </div>
      </div>
      <!-- BOTTOM NAVIGATION (MOBILE) -->
      <nav class="app-footer-nav">
        <a href="dashboard.html" class="app-nav-item">
          <span class="material-symbols-outlined">grid_view</span>
          <span>Dashboard</span>
        </a>
        <a href="alunos.html" class="app-nav-item">
          <span class="material-symbols-outlined">group</span>
          <span>Alunos</span>
        </a>
        <a href="calendario.html" class="app-nav-item">
          <span class="material-symbols-outlined">calendar_month</span>
          <span>Calendário</span>
        </a>
        <a href="faturacao.html" class="app-nav-item">
          <span class="material-symbols-outlined">payments</span>
          <span>Faturação</span>
        </a>
        <a href="relatorios.html" class="app-nav-item">
          <span class="material-symbols-outlined">trending_up</span>
          <span>Relatórios</span>
        </a>
        <a href="perfil.html" class="app-nav-item">
          <span class="material-symbols-outlined">person</span>
          <span>Perfil</span>
        </a>
      </nav>
    </section>

    <!-- MODAL RELATÓRIO MÊS -->
    <div class="modal" id="modal-relatorio-mes">
      <div class="modal__backdrop" onclick="closeRelModal()"></div>
      <div class="modal__dialog" style="max-width: 600px">
        <div class="modal__header">
          <h2 id="modal-rel-titulo">Relatório — Mês</h2>
          <button class="modal__close" onclick="closeRelModal()">
            &times;
          </button>
        </div>
        <div id="modal-rel-body">
          <p>A carregar...</p>
        </div>
      </div>
    </div>

    <!-- Navigation Logic -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
    />
    <script src="../../public/js/nav.js"></script>

    <script src="../../public/js/explicador-service.js"></script>
    <script src="../../public/js/relatorios-explicador.js"></script>
  </body>
</html>
